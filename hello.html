<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World</title>
    <script src="https://unpkg.com/react@latest/dist/react.js"></script>
    <script src="https://unpkg.com/react-dom@latest/dist/react-dom.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      function Display(props) {
        return (
          <div style={{
            border: '1px solid black',
            boxSizing: 'border-box',
            fontSize: '50px',
            height: '100px',
            padding: '20px',
            width: '400px',
          }}>
            {props.text}
          </div>
        );
      }

      function NumberPad(props) {
        return (
          <div style={{
            display: 'flex',
          }}>
            <div style={{
              display: 'flex',
              flexDirection: 'column',
              height: '400px',
            }}>
              <div style={{
                display: 'flex',
                flex: 1,
                width: '300px',
              }}>
                <Button value="1" onClick={(value) => props.onClick(value)} />
                <Button value="2" onClick={(value) => props.onClick(value)} />
                <Button value="3" onClick={(value) => props.onClick(value)} />
              </div>
              <div style={{
                display: 'flex',
                flex: 1,
                width: '300px',
              }}>
                <Button value="4" onClick={(value) => props.onClick(value)} />
                <Button value="5" onClick={(value) => props.onClick(value)} />
                <Button value="6" onClick={(value) => props.onClick(value)} />
              </div>
              <div style={{
                display: 'flex',
                flex: 1,
                width: '300px',
              }}>
                <Button value="7" onClick={(value) => props.onClick(value)} />
                <Button value="8" onClick={(value) => props.onClick(value)} />
                <Button value="9" onClick={(value) => props.onClick(value)} />
              </div>
              <div style={{
                display: 'flex',
                flex: 1,
                width: '300px',
              }}>
                <Button value="C" onClick={(value) => props.onClick(value)} />
                <Button value="0" onClick={(value) => props.onClick(value)} />
                <Button value="=" onClick={(value) => props.onClick(value)} />
              </div>
            </div>
            <div style={{
              display: 'flex',
              flexDirection: 'column',
              height: '400px',
              width: '100px',
            }}>
              <Button value="+" onClick={(value) => props.onClick(value)} />
              <Button value="-" onClick={(value) => props.onClick(value)} />
              <Button value="*" onClick={(value) => props.onClick(value)} />
              <Button value="/" onClick={(value) => props.onClick(value)} />
            </div>
          </div>
        );
      }

      function Button(props) {
        return (
          <button
              style={{
                alignItems: 'center',
                // border: '1px solid black',
                display: 'flex',
                flex: 1,
                fontSize: '50px',
                justifyContent: 'center',
              }}
              onClick={() => props.onClick(props.value)}>
            {props.value}
          </button>
        );
      }

      class Root extends React.Component {
        constructor() {
          super();

          this.state = {
            displayText: '',
          };
        }

        render() {
          return (
            <div>
              <Display text={this.state.displayText} />
              <div style={{display: 'flex'}}>
                <NumberPad onClick={(value) => this.handleClick(value)} />
              </div>
            </div>
          );
        }

        handleClick(value) {
          var displayText = this.state.displayText;
          if (value == 'C') {
            displayText = '';
          } else if (value == '=') {
            if (displayText.length > 0) {
              var lastChar = displayText[displayText.length - 1];
              if (this.isNumber(lastChar)) {
                displayText = '' + this.calculateValue(displayText);
              }
            }
          } else if (!this.isNumber(value)) {
            if (displayText.length > 0) {
              var lastChar = displayText[displayText.length - 1];
              if (this.isNumber(lastChar)) {
                displayText += ' ' + value;
              } else {
                displayText =
                    displayText.substring(0, displayText.length - 1) + value;
              }
            }
          } else {
            if (displayText.length > 0) {
              var lastChar = displayText[displayText.length - 1];
              if (this.isNumber(lastChar)) {
                displayText += value;
              } else {
                displayText += ' ' + value;
              }
            } else {
              displayText = value;
            }
          }

          this.setState({
            displayText: displayText,
          });
        }

        isNumber(value) {
          return value == '0' ||
              value == '1' ||
              value == '2' ||
              value == '3' ||
              value == '4' ||
              value == '5' ||
              value == '6' ||
              value == '7' ||
              value == '8' ||
              value == '9';
        }

        calculateValue(displayText) {
          if (displayText == '') return displayText;

          var result = this.reduceExpression(displayText.split(' '));
          return parseInt(result[0]);
        }

        reduceExpression(parts) {
          console.log(parts);

          var index;
          if (this.firstSymbolIndex(parts, ['*', '/']) > -1) {
            var index = this.firstSymbolIndex(parts, ['*', '/']);
            var first = parseFloat(parts[index - 1]);
            var second = parseFloat(parts[index + 1]);
            var result;
            if (parts[index] == '*') {
              result = first * second;
            } else {
              result = first / second;
            }
            return this.reduceExpression(
              parts
                .slice(0, index - 1)
                .concat([result])
                .concat(parts.slice(index + 2)));
          } else if (this.firstSymbolIndex(parts, ['+', '-']) > -1) {
            var index = this.firstSymbolIndex(parts, ['+', '-']);
            var first = parseFloat(parts[index - 1]);
            var second = parseFloat(parts[index + 1]);
            var result;
            if (parts[index] == '+') {
              result = first + second;
            } else {
              result = first - second;
            }
            return this.reduceExpression(
              parts
                .slice(0, index - 1)
                .concat([result])
                .concat(parts.slice(index + 2)));
          } else {
            return parts;
          }
        }

        firstSymbolIndex(parts, symbols) {
          for (var i = 0, part; part = parts[i]; i++) {
            if (symbols.indexOf(part) > -1) {
              return i;
            }
          }

          return -1;
        }
      }

      ReactDOM.render(<Root />, document.getElementById('root'));

    </script>
  </body>
</html>
